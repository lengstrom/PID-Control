<html>
	<head>
		<title>PID Control</title>
		<style type="text/css">
			#c {
				width:500px;
				height:500px;
				position:relative;
				padding-left: 30px;
				padding-top: 30px;
			}
		</style>
	</head>
	<body>
		<canvas id = 'c' width = '500' height = '500'></canvas>
		<script type="text/javascript">
			window.requestAnimFrame = (function() {
				return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function(callback) {
				window.setTimeout(callback, 1000 / framerate);
				};
			})();

			function PIDController(opts) {
				this.initialized = false;
				var lastTime = 0;
				var lastError = false;
				this.init = function(opts) {
					this.initialized = true;
					this.p = 0;
					this.i = 0;
					this.d = 0;

					this.integral = 0;
					lastTime = (new Date()).getTime();
					lastError = false;

					for (var i in opts) {
						this[i] = opts[i];
					}
				};

				this.run = function() {
					requestAnimFrame(this.update);
				};

				this.update = function(currentValue, targetValue) {
					var currentTime = (new Date()).getTime();
					var dt = currentTime - lastTime;
					lastTime = currentTime;
					var currentError = (targetValue - currentValue);
					var pTerm = currentError * this.p;

					this.integral += currentError;
					var iTerm = this.integral * this.i;

					var dTerm = 0;
					if (lastError) {
						dTerm = (currentError - lastError) * this.d;
					}

					var updateTerm = (pTerm + iTerm + dTerm)/dt;
					return updateTerm;
				}

				this.init(opts);
			}

			function PIDCanvas(c) {
				var lastTime = 0;
				var canvas = false;
				var ctx = false;
				this.init = function(c) {
					debugger;
					canvas = document.getElementById(c);
					ctx = canvas.getContext('2d');
					for (var i in opts) {
						this[i] = opts[i];
					}

					requestAnimFrame(this.update)
				};

				this.block = {
					x:0,
					m:15,
					k_f:.3
				};

				this.seeSaw = {
					theta:0,
					length:300,
					height:20
				};

				this.update = function() {
					this.draw();
					requestAnimFrame(this.update);
				};

				this.draw = function() {
					var center = {
						x:canvas.width/2,
						y:canvas.height/2
					};

					var p1 = {x:-this.seeSaw.length/2, y:-this.seeSaw.height/2};
					var p2 = {x:this.seeSaw.length/2, y:-this.seeSaw.height/2};
					var p3 = {x:this.seeSaw.length/2, y:this.seeSaw.height/2};
					var p4 = {x:-this.seeSaw.length/2, y:this.seeSaw.height/2};
					var points = [p1, p2, p3, p4];
					var t = this;
					points = map(function(p) {
						return rotatePoint(p, t.seeSaw.theta)
					}, points);

					points = map(function(p) {
						return {x:p.x + center.x, y:p.x + center.y};
					}, points);

					ctx.strokeStyle = '#000';
					ctx.lineWidth = 3;
					ctx.beginPath();
					ctx.moveTo(points[0]);
					ctx.lineTo(points[1]);
					ctx.lineTo(points[2]);
					ctx.lineTo(points[3]);
					ctx.lineTo(points[0]);
					ctx.stroke();
				};

				this.init(c);
			}

			function rotatePoint(p, theta) {
				var rotX = Math.cos(thetaRad) * p.x - Math.sin(thetaRad) * p.y;
				var rotY = Math.sin(thetaRad) * p.x + Math.cos(thetaRad) * p.y;

				return {
					x: rotX,
					y: rotY
				};
			}

			var a = new PIDCanvas('c');

		</script>
	</body>
</html>